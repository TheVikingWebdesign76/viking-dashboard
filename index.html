<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Viking N8N - Client Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }

        .logo {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .login-section {
            background: rgba(255, 255, 255, 0.15);
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            text-align: center;
        }

        .client-input {
            display: flex;
            gap: 10px;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
        }

        input {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            min-width: 200px;
        }

        button {
            padding: 12px 24px;
            background: #ff6b35;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        button:hover {
            background: #e55a2b;
            transform: translateY(-2px);
        }

        button:disabled {
            background: #999;
            cursor: not-allowed;
            transform: none;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #ffffff;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .error-message {
            background: rgba(239, 68, 68, 0.2);
            color: #fecaca;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            border-left: 4px solid #ef4444;
        }

        .dashboard {
            display: none;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .dashboard.active {
            display: grid;
        }

        .card {
            background: rgba(255, 255, 255, 0.15);
            padding: 25px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .card h3 {
            margin-bottom: 20px;
            font-size: 1.3rem;
            color: #fff;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .stat-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .client-info {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .logout-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(239, 68, 68, 0.8);
            font-size: 14px;
            padding: 8px 16px;
            display: none;
        }

        .logout-btn.active {
            display: block;
        }

        @media (max-width: 768px) {
            .client-input {
                flex-direction: column;
            }
            
            input {
                min-width: 250px;
            }
            
            .stat-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">‚öîÔ∏è The Viking Webdesign</div>
            <div>N8N Lead Generation & Email Marketing Dashboard</div>
        </div>

        <div class="login-section" id="loginSection">
            <h2>üîê Secure Client Login</h2>
            <p style="margin-bottom: 20px;">Enter your credentials to access your dashboard</p>
            <div class="client-input">
                <input type="text" id="clientId" placeholder="Client ID" />
                <input type="password" id="clientPassword" placeholder="Password" />
                <button onclick="authenticateClient()" id="loginBtn">
                    <span id="loginText">üìä Login</span>
                </button>
            </div>
            <div id="errorMessage"></div>
        </div>

        <div class="dashboard" id="dashboard">
            <!-- Client Info -->
            <div class="card">
                <h3>üë§ Client Information</h3>
                <div class="client-info">
                    <div><strong>Client:</strong> <span id="clientName">-</span></div>
                    <div><strong>Package:</strong> <span id="clientPackage">-</span></div>
                    <div><strong>Active since:</strong> <span id="clientSince">-</span></div>
                    <div><strong>Session:</strong> <span id="sessionInfo">Secure connection</span></div>
                </div>
            </div>

            <!-- Workflow Statistics -->
            <div class="card">
                <h3>‚öôÔ∏è N8N Workflow Status</h3>
                <div class="stat-grid">
                    <div class="stat-item">
                        <div class="stat-number" id="activeWorkflows">-</div>
                        <div class="stat-label">Active Workflows</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="totalExecutions">-</div>
                        <div class="stat-label">Total Executions</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="successRate">-</div>
                        <div class="stat-label">Success Rate</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="lastRun">-</div>
                        <div class="stat-label">Last Run</div>
                    </div>
                </div>
            </div>

            <!-- Lead Generation -->
            <div class="card">
                <h3>üéØ Lead Generation (Today)</h3>
                <div class="stat-grid">
                    <div class="stat-item">
                        <div class="stat-number" id="newLeads">-</div>
                        <div class="stat-label">New Leads</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="qualifiedLeads">-</div>
                        <div class="stat-label">Qualified</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="totalLeads">-</div>
                        <div class="stat-label">Total Database</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="conversionRate">-</div>
                        <div class="stat-label">Conversion Rate</div>
                    </div>
                </div>
            </div>

            <!-- Email Campaigns -->
            <div class="card">
                <h3>üìß Email Campaign Results</h3>
                <div class="stat-grid">
                    <div class="stat-item">
                        <div class="stat-number" id="emailsSent">-</div>
                        <div class="stat-label">Emails Sent</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="emailsOpened">-</div>
                        <div class="stat-label">Opened</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="emailsClicked">-</div>
                        <div class="stat-label">Clicked</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="emailsReplied">-</div>
                        <div class="stat-label">Replied</div>
                    </div>
                </div>
            </div>
        </div>

        <button class="logout-btn" id="logoutBtn" onclick="logout()">üö™ Logout</button>
    </div>

    <script>
        // N8N API Configuration
        const N8N_API_BASE = 'https://n8n.thevikingwebdesign.com/webhook';  // YOUR N8N URL
        
        let currentSession = null;

        // Authentication function
        async function authenticateClient() {
            const clientId = document.getElementById('clientId').value.trim();
            const password = document.getElementById('clientPassword').value.trim();
            const loginBtn = document.getElementById('loginBtn');
            const errorDiv = document.getElementById('errorMessage');
            
            // Clear previous errors
            errorDiv.innerHTML = '';
            
            // Validation
            if (!clientId || !password) {
                showError('Please enter both Client ID and Password');
                return;
            }
            
            // Show loading
            loginBtn.disabled = true;
            document.getElementById('loginText').innerHTML = '<span class="loading"></span> Authenticating...';
            
            try {
                // Call N8N authentication API
                const response = await fetch(`${N8N_API_BASE}/client-login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        client_id: clientId,
                        password: password
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    // Authentication successful
                    currentSession = data;
                    showDashboard(data);
                    loadClientData(data);
                } else {
                    // Authentication failed
                    showError(data.message || 'Authentication failed');
                }
                
            } catch (error) {
                console.error('Authentication error:', error);
                showError('Connection error. Please try again.');
            } finally {
                // Reset button
                loginBtn.disabled = false;
                document.getElementById('loginText').innerHTML = 'üìä Login';
            }
        }
        
        // Show dashboard after successful login
        function showDashboard(sessionData) {
            document.getElementById('loginSection').style.display = 'none';
            document.getElementById('dashboard').classList.add('active');
            document.getElementById('logoutBtn').classList.add('active');
            
            // Update client info
            document.getElementById('clientName').textContent = sessionData.client_name;
            document.getElementById('clientPackage').textContent = sessionData.package_type;
            document.getElementById('clientSince').textContent = sessionData.active_since;
            document.getElementById('sessionInfo').textContent = 'Secure connection ‚úÖ';
        }
        
        // Load real client data from N8N
        async function loadClientData(sessionData) {
            try {
                // Call your existing dashboard data API
                const response = await fetch(`${N8N_API_BASE}/dashboard-webhook`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${sessionData.session_token}`
                    },
                    body: JSON.stringify({
                        client_id: sessionData.client_id
                    })
                });
                
                const dashboardData = await response.json();
                
                if (dashboardData) {
                    updateDashboardStats(dashboardData);
                }
                
            } catch (error) {
                console.error('Failed to load dashboard data:', error);
                // Fall back to demo data
                loadDemoData(sessionData.client_id);
            }
        }
        
        // Update dashboard with real data
        function updateDashboardStats(data) {
            if (data.workflow_stats) {
                document.getElementById('activeWorkflows').textContent = data.workflow_stats.active_workflows || '-';
                document.getElementById('totalExecutions').textContent = (data.workflow_stats.total_executions || 0).toLocaleString();
                document.getElementById('successRate').textContent = (data.workflow_stats.success_rate || 0) + '%';
                document.getElementById('lastRun').textContent = (data.workflow_stats.last_run_minutes || 0) + ' min';
            }
            
            if (data.lead_stats) {
                document.getElementById('newLeads').textContent = data.lead_stats.new_leads_today || 0;
                document.getElementById('qualifiedLeads').textContent = data.lead_stats.qualified_leads_today || 0;
                document.getElementById('totalLeads').textContent = (data.lead_stats.total_database || 0).toLocaleString();
                document.getElementById('conversionRate').textContent = (data.lead_stats.conversion_rate || 0) + '%';
            }
            
            if (data.email_stats) {
                document.getElementById('emailsSent').textContent = data.email_stats.sent_today || 0;
                document.getElementById('emailsOpened').textContent = data.email_stats.opened_today || 0;
                document.getElementById('emailsClicked').textContent = data.email_stats.clicked_today || 0;
                document.getElementById('emailsReplied').textContent = data.email_stats.replied_today || 0;
            }
        }
        
        // Fallback demo data
        function loadDemoData(clientId) {
            const demoData = {
                'VIKING001': { workflows: 8, executions: 1247, newLeads: 23, emailsSent: 156 },
                'CLIENT001': { workflows: 5, executions: 892, newLeads: 15, emailsSent: 98 },
                'CLIENT002': { workflows: 3, executions: 445, newLeads: 8, emailsSent: 45 }
            };
            
            const data = demoData[clientId] || demoData['CLIENT001'];
            
            document.getElementById('activeWorkflows').textContent = data.workflows;
            document.getElementById('totalExecutions').textContent = data.executions.toLocaleString();
            document.getElementById('successRate').textContent = '98.2%';
            document.getElementById('newLeads').textContent = data.newLeads;
            document.getElementById('emailsSent').textContent = data.emailsSent;
            document.getElementById('lastRun').textContent = '2 min';
        }
        
        // Error display
        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.innerHTML = `<div class="error-message">‚ùå ${message}</div>`;
        }
        
        // Logout function
        function logout() {
            currentSession = null;
            document.getElementById('loginSection').style.display = 'block';
            document.getElementById('dashboard').classList.remove('active');
            document.getElementById('logoutBtn').classList.remove('active');
            document.getElementById('clientId').value = '';
            document.getElementById('clientPassword').value = '';
            document.getElementById('errorMessage').innerHTML = '';
        }
        
        // Enter key support
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && !document.getElementById('dashboard').classList.contains('active')) {
                authenticateClient();
            }
        });
        
        // Auto-refresh dashboard data every 5 minutes
        setInterval(() => {
            if (currentSession) {
                loadClientData(currentSession);
            }
        }, 300000); // 5 minutes
    </script>
</body>
</html>
